# Getting Started

Welcome to PageSpace! This guide will walk you through setting up your local development environment. PageSpace is a local-first, collaborative knowledge management tool designed for privacy and extensibility.

## Prerequisites

Before you begin, ensure you have the following installed:

- **Node.js**: v20.x or later
- **pnpm**: If you don't have pnpm, you can install it with `npm install -g pnpm`
- **Docker**: Required for running the complete application stack. [Download Docker](https://www.docker.com/products/docker-desktop)

## Installation

1.  **Clone the repository:**
    ```bash
    git clone <repository-url>
    cd PageSpace
    ```

2.  **Install dependencies:**
    ```bash
    pnpm install
    ```

3.  **Set up environment variables:**

    Copy the example environment file to create your local configuration:
    ```bash
    cp .env.example .env
    ```
    
    **Important**: You must generate secure secrets for the following variables in your `.env` file:

    - `JWT_SECRET`: A secure random string for JWT token signing
    - `CSRF_SECRET`: A secure random string for CSRF protection
    - `ENCRYPTION_KEY`: A 32-byte hex string for encrypting sensitive data

    You can generate these using online tools or command line utilities like `openssl rand -hex 32`.

    > **Note on `ENCRYPTION_SALT` (Deprecated)**: New installations should **not** set `ENCRYPTION_SALT`. The application now uses unique per-operation salts for improved security. This variable is only needed for existing installations that have legacy encrypted data (e.g., encrypted API keys). If you're upgrading from an older version and have encrypted data, keep your existing `ENCRYPTION_SALT` until you've run the migration script. See [Migrating Legacy Encrypted Data](#migrating-legacy-encrypted-data) below.

4.  **Start the development environment:**

    PageSpace uses Docker Compose to orchestrate all services. Choose one of these options:

    **Option A: Full Docker deployment (recommended for production-like testing):**
    ```bash
    docker compose up
    ```
    
    **Option B: Development mode with Turborepo (recommended for development):**
    ```bash
    pnpm dev
    ```
    
    The development command starts:
    - PostgreSQL database in Docker
    - Database migrations
    - Web application (Next.js)
    - Realtime service (Socket.IO)

## Accessing the Application

Once the services are running, you can access:

- **Web Application**: `http://localhost:3000`
- **Realtime Server**: `http://localhost:3001`

## AI Configuration (Optional)

PageSpace supports multiple AI providers:

- **Ollama** (local): Install Ollama and pull models like `llama3` for local AI processing
- **OpenRouter** (cloud): Add your OpenRouter API key to `OPENROUTER_DEFAULT_API_KEY` for access to various cloud models
- **Google OAuth** (optional): Configure Google OAuth credentials for enhanced authentication

## Development Commands

```bash
# Development
pnpm dev                    # Start all services in development mode
pnpm --filter web dev       # Start web app only

# Build
pnpm build                  # Build all applications
pnpm --filter web build     # Build web app only

# Database
pnpm db:generate            # Generate Drizzle migrations
pnpm db:migrate             # Run database migrations

# Linting
pnpm --filter web lint      # Run ESLint on web app
pnpm typecheck              # Run TypeScript checks
```

## Migrating Legacy Encrypted Data

If you're upgrading from an older version of PageSpace that used `ENCRYPTION_SALT`, you may have encrypted data (such as AI provider API keys) stored in the legacy format. The legacy format used a static salt, which is less secure than the current format that uses unique per-operation salts.

**Automatic Migration**: When you access settings that contain legacy encrypted data, the application will automatically migrate them to the new format. No action is required for day-to-day usage.

**Manual Batch Migration**: To migrate all legacy encrypted data at once, you can run the migration script:

```bash
# Preview what will be migrated (dry run)
pnpm --filter @pagespace/db migrate:encryption:dry-run

# Run the actual migration
pnpm --filter @pagespace/db migrate:encryption
```

**After Migration**: Once all legacy data has been migrated, you can safely remove `ENCRYPTION_SALT` from your environment. The application will log deprecation warnings when legacy-format data is detected, helping you identify any remaining legacy entries.

## Next Steps

1. Navigate to `http://localhost:3000` to create your first user account
2. Explore the knowledge management features and AI integration
3. Review the architecture documentation in `docs/2.0-architecture/` for development guidance

