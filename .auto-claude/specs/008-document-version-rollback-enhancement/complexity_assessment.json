{
  "complexity": "complex",
  "workflow_type": "feature",
  "confidence": 0.85,
  "reasoning": "Database infrastructure changes for version storage optimization, selective rollback requires sophisticated change tracking architecture, and handling multiple content types (especially embedded files) across version operations. Cross-cutting changes affecting storage, backend logic, and UI layers.",

  "analysis": {
    "scope": {
      "estimated_files": 14,
      "estimated_services": 2,
      "is_cross_cutting": true,
      "notes": "Version management, diff visualization, rollback logic, storage optimization, and UI for diff display. Touches backend version storage, business logic layer, and frontend diff interface."
    },
    "integrations": {
      "external_services": [],
      "new_dependencies": ["diff-match-patch or similar diff library"],
      "research_needed": true,
      "notes": "No external service integrations, but need to research diff algorithms/libraries and selective rollback architectural patterns. Diff libraries are well-documented but choosing the right approach requires investigation."
    },
    "infrastructure": {
      "docker_changes": false,
      "database_changes": true,
      "config_changes": true,
      "notes": "Database schema changes for version storage optimization and compression. Configuration changes for 30-day retention policy enforcement. Storage layer optimization for large documents is critical infrastructure work."
    },
    "knowledge": {
      "patterns_exist": true,
      "research_required": true,
      "unfamiliar_tech": [],
      "notes": "Existing version history system provides foundation, but selective rollback and granular change tracking are new architectural patterns. Need to research merge strategies for partial reverts and optimal diff algorithms."
    },
    "risk": {
      "level": "high",
      "concerns": [
        "Data integrity during partial rollback operations",
        "Backwards compatibility with existing version history data",
        "Performance degradation with large document versions",
        "Edge cases in embedded file rollback",
        "Merge conflicts in selective rollback scenarios"
      ],
      "notes": "Version control operations are inherently risky - incorrect rollback could cause data loss. Selective rollback adds complexity where partial changes must be cleanly separated and reverted without breaking document integrity."
    }
  },

  "recommended_phases": [
    "discovery",
    "requirements",
    "research",
    "context",
    "spec_writing",
    "self_critique",
    "planning",
    "validation"
  ],

  "flags": {
    "needs_research": true,
    "needs_self_critique": true,
    "needs_infrastructure_setup": false
  },

  "validation_recommendations": {
    "risk_level": "high",
    "skip_validation": false,
    "minimal_mode": false,
    "test_types_required": ["unit", "integration", "e2e"],
    "security_scan_required": false,
    "staging_deployment_required": false,
    "reasoning": "Version control and rollback operations are high-risk for data integrity. Requires comprehensive testing including E2E scenarios to verify rollback flows work correctly without data loss. No security scan needed as this doesn't involve auth/payment systems."
  },

  "created_at": "2025-12-31T00:00:00Z"
}
